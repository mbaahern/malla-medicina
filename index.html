<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Malla Curricular Medicina</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
    }
    .contenedor {
      display: flex;
      gap: 20px;
      overflow-x: auto;
      padding-bottom: 20px;
    }
    .columna {
      flex: 0 0 200px;
      background: #ffffff;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 10px;
      text-align: center;
    }
    .columna h2 {
      font-size: 16px;
      margin-bottom: 10px;
    }
    .ramo {
      background: #e0f0ff;
      border: 1px solid #99ccee;
      border-radius: 6px;
      margin: 6px 0;
      padding: 6px;
      font-size: 14px;
      cursor: pointer;
    }
    .ramo.aprobado {
      background: #c8e6c9;
      text-decoration: line-through;
    }
    .ramo.anual {
      background: #ffe0b2;
      border: 1px solid #e6a157;
      grid-column: span 2;
      min-height: 60px;
    }
    .fila-anual {
      display: grid;
      grid-template-columns: 200px 200px;
      gap: 20px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>Malla Curricular Medicina</h1>
  <div class="contenedor" id="contenedor"></div>

  <script>
    const malla = [
      {
        semestre: 7,
        ramos: [
          { nombre: "Medicina Interna", codigo: "MED296", anual: true, requisitos: ["MED249","MED260","BIO288","MED257"] },
          { nombre: "Cirugía", codigo: "MED287", anual: true, requisitos: ["MED260","BIO288"] },
          { nombre: "Neurología", codigo: "MED244", requisitos: ["MED249","BIO288"] },
          { nombre: "Patología I", codigo: "MED294", requisitos: ["BIO320","BIO321","BIO377"] },
          { nombre: "Salud Pública I", codigo: "MED292", requisitos: ["MED279"] }
        ]
      },
      { semestre: 8, ramos: [] }
    ];

    let aprobados = JSON.parse(localStorage.getItem("aprobados")) || [];

    function guardarEstado() {
      localStorage.setItem("aprobados", JSON.stringify(aprobados));
    }

    function puedeTomar(ramo) {
      if (!ramo.requisitos) return true;
      return ramo.requisitos.every(r => aprobados.includes(r));
    }

    function renderizarMalla() {
      const contenedor = document.getElementById("contenedor");
      contenedor.innerHTML = "";

      for (let i = 0; i < malla.length; i++) {
        const semestre = malla[i];
        const columna = document.createElement("div");
        columna.className = "columna";

        const titulo = document.createElement("h2");
        titulo.textContent = `Semestre ${semestre.semestre}`;
        columna.appendChild(titulo);

        semestre.ramos.forEach(ramo => {
          if (ramo.anual) return; // no duplicar, se renderiza aparte
          const div = crearRamo(ramo);
          columna.appendChild(div);
        });

        contenedor.appendChild(columna);
      }

      // ahora renderizamos los anuales como fila especial
      const filaAnual = document.createElement("div");
      filaAnual.className = "fila-anual";

      malla[0].ramos.forEach(ramo => {
        if (ramo.anual) {
          const div = crearRamo(ramo);
          div.classList.add("anual");
          filaAnual.appendChild(div);
        }
      });

      contenedor.insertBefore(filaAnual, contenedor.children[1]);
    }

    function crearRamo(ramo) {
      const div = document.createElement("div");
      div.className = "ramo";
      if (ramo.anual) div.classList.add("anual");
      if (aprobados.includes(ramo.codigo)) div.classList.add("aprobado");
      if (!puedeTomar(ramo) && !aprobados.includes(ramo.codigo)) div.style.opacity = "0.4";
      div.textContent = `${ramo.nombre} (${ramo.codigo})`;
      div.onclick = () => {
        if (!puedeTomar(ramo) && !aprobados.includes(ramo.codigo)) return;
        if (aprobados.includes(ramo.codigo)) {
          aprobados = aprobados.filter(c => c !== ramo.codigo);
        } else {
          aprobados.push(ramo.codigo);
        }
        guardarEstado();
        renderizarMalla();
      };
      return div;
    }

    renderizarMalla();
  </script>
</body>
</html>
