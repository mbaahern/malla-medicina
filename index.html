<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Malla Curricular Medicina</title>
  <!-- Favicon emoji (fonendoscopio) -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 16 16%22><text y=%2214%22 font-size=%2212%22>ü©∫</text></svg>">

  <style>
    :root{
      --colw: 180px;        /* ancho de cada columna */
      --gap: 10px;          /* separaci√≥n entre columnas */
      --rosa-10:#fff5f9;
      --rosa-20:#fde2ec;
      --rosa-30:#f8cddc;
      --rosa-40:#f8b8cd;
      --rosa-60:#f597b2;
      --rosa-70:#df6b91;
      --rosa-80:#b83268;
      --texto:#333;
    }

    body {
      margin: 10px;
      font-family: Arial, sans-serif;
      background: #ffffff;
      color: var(--texto);
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      color: var(--rosa-80);
      font-weight: 700;
      font-size: 2rem;
      margin-bottom: 12px;
      text-align: center;
    }

    /* Contenedor horizontal (todas las columnas) */
    #contenedor {
      display: flex;
      gap: var(--gap);
      overflow-x: auto;
      padding: 10px;
      max-width: 100vw;
      box-sizing: border-box;
      -webkit-overflow-scrolling: touch;
    }
    #contenedor::-webkit-scrollbar { height: 6px; }
    #contenedor::-webkit-scrollbar-thumb {
      background-color: var(--rosa-80);
      border-radius: 3px;
    }

    /* Columna de un periodo est√°ndar */
    .columna {
      flex: 0 0 var(--colw);
      background: var(--rosa-20);
      border-radius: 8px;
      padding: 10px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      max-height: 90vh;
      overflow-y: auto;
    }
    .columna h2 {
      color: var(--rosa-80);
      margin: 0 0 8px 0;
      text-align: center;
      border-bottom: 2px solid var(--rosa-80);
      padding-bottom: 4px;
      font-size: 1rem;
      font-weight: bold;
      user-select: none;
    }

    /* Tarjeta de ramo */
    .ramo {
      background: white;
      border: 1px solid var(--rosa-40);
      color: var(--rosa-80);
      margin-bottom: 6px;
      padding: 8px;
      border-radius: 5px;
      cursor: pointer;
      user-select: none;
      position: relative;
      font-size: 0.8rem;
      line-height: 1.2em;
      transition: background-color 0.2s ease, color 0.2s ease, opacity 0.2s ease;
    }
    .ramo:hover:not(.bloqueado) {
      background-color: var(--rosa-20);
    }
    .ramo.bloqueado {
      background-color: var(--rosa-30);
      opacity: 0.5;
      cursor: not-allowed;
    }
    .ramo.aprobado {
      background-color: var(--rosa-60);
      color: white;
      text-decoration: line-through;
    }
    .codigo {
      font-size: 0.7rem;
      font-weight: bold;
      margin-left: 5px;
      user-select: text;
    }
    .anual-tag {
      position: absolute;
      top: 4px;
      right: 4px;
      background: var(--rosa-80);
      color: white;
      font-size: 0.65rem;
      padding: 1px 5px;
      border-radius: 4px;
      user-select: none;
    }

    /* ====== Bloque especial que agrupa Sem 7 + Sem 8 y la barra anual que los cruza ====== */
    .wrapper-7-8 {
      /* este bloque ocupa el ancho de dos columnas + el gap interno */
      flex: 0 0 calc((var(--colw) * 2) + var(--gap));
      display: grid;
      grid-template-columns: var(--colw) var(--colw);
      gap: var(--gap);
      /* sin fondo propio: adentro hay dos ‚Äú.columna‚Äù iguales a las dem√°s */
    }

    /* Barra que se extiende a lo largo de Sem 7 y 8 */
    .barra-anual {
      grid-column: 1 / span 2;      /* ocupa ambas columnas */
      background: var(--rosa-10);
      border: 2px dashed var(--rosa-40);
      border-radius: 8px;
      padding: 8px;
      margin-bottom: var(--gap);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    /* Cada ramo anual dentro de la barra larga */
    .ramo.anual {
      background: white;
      border: 1px solid var(--rosa-40);
      border-left: 6px solid var(--rosa-80);
      color: var(--rosa-80);
      width: 100%;              /* barra completa */
      min-height: 48px;
      display: flex;
      align-items: center;
      padding-left: 10px;
      margin: 0;                /* la separaci√≥n la da .barra-anual */
    }
    .ramo.anual.aprobado {
      background: var(--rosa-60);
      color: white;
      text-decoration: line-through;
      border-left-color: white;
    }
    .ramo.anual.bloqueado {
      background: var(--rosa-30);
      opacity: 0.5;
      cursor: not-allowed;
    }

    @media (max-width: 600px) {
      :root { --colw: 140px; }
      .columna { padding: 6px 8px; }
      .columna h2 { font-size: 0.9rem; }
      .ramo { font-size: 0.7rem; padding: 6px 5px; }
      .codigo { font-size: 0.6rem; }
    }
  </style>
</head>
<body>
  <h1>Malla Curricular Medicina</h1>
  <div id="contenedor"></div>

  <script>
    /* =========================
       DATOS DE LA MALLA
       ========================= */
    const malla = [
      {
        periodo: "Semestre 1",
        ramos: [
          { nombre: "Introducci√≥n a la Medicina I", codigo: "MED016" },
          { nombre: "Matem√°ticas Avanzada", codigo: "FMM007" },
          { nombre: "Qu√≠mica General", codigo: "QUI109" },
          { nombre: "Biolog√≠a Celular", codigo: "BIO130" },
          { nombre: "Laboratorio Biolog√≠a Celular", codigo: "BIO131" },
          { nombre: "Electivo de Formaci√≥n General", codigo: "CEG001" }
        ]
      },
      {
        periodo: "Semestre 2",
        ramos: [
          { nombre: "Introducci√≥n a la Medicina II", codigo: "MED017", requisitos: ["MED016"] },
          { nombre: "F√≠sica", codigo: "FMF019", requisitos: ["FMM007"] },
          { nombre: "Qu√≠mica Org√°nica", codigo: "QUI024", requisitos: ["QUI109"] },
          { nombre: "Anatom√≠a Humana I", codigo: "MOR330" },
          { nombre: "Laboratorio Anatom√≠a Humana I", codigo: "MOR331" },
          { nombre: "Electivo de Formaci√≥n General", codigo: "CEG002" }
        ]
      },
      {
        periodo: "Semestre 3",
        ramos: [
          { nombre: "M√©dico Paciente", codigo: "MED121", requisitos: ["MED017"] },
          { nombre: "Fisiolog√≠a Humana I", codigo: "BIO376", requisitos: ["BIO130", "BIO131", "FMF019", "MOR330", "MOR331"] },
          { nombre: "Bioqu√≠mica", codigo: "BIO266", requisitos: ["QUI024"] },
          { nombre: "Anatom√≠a Humana II", codigo: "MOR332", requisitos: ["MOR330"] },
          { nombre: "Laboratorio Anatom√≠a Humana II", codigo: "MOR333", requisitos: ["MOR331"] },
          { nombre: "Antropolog√≠a Filos√≥fica", codigo: "HUF124" }
        ]
      },
      {
        periodo: "Semestre 4",
        ramos: [
          { nombre: "M√©dico Paciente II", codigo: "MED122", requisitos: ["MED121"] },
          { nombre: "Fisiolog√≠a Humana II", codigo: "BIO377", requisitos: ["BIO376"] },
          { nombre: "Gen√©tica y Biolog√≠a Molecular Humana", codigo: "BIO148", requisitos: ["BIO130", "BIO131"] },
          { nombre: "Laboratorio Gen√©tica y Biolog√≠a Molecular Humana", codigo: "BIO242", requisitos: ["BIO130", "BIO131"] },
          { nombre: "Histolog√≠a", codigo: "BIO320", requisitos: ["MOR332", "MOR333", "BIO130", "BIO131"] },
          { nombre: "Laboratorio de Histolog√≠a", codigo: "BIO321", requisitos: ["MOR332", "MOR333", "BIO130", "BIO131"] },
          { nombre: "Psicolog√≠a", codigo: "MED131" },
          { nombre: "Electivo de Formaci√≥n General III", codigo: "CEG003" }
        ]
      },
      {
        periodo: "Semestre 5",
        ramos: [
          { nombre: "Semiolog√≠a M√©dica", codigo: "MED250", requisitos: ["BIO377", "MED122", "BIO320", "BIO321"] },
          { nombre: "Inmunolog√≠a y Nutrici√≥n", codigo: "MED257", requisitos: ["BIO377", "BIO320", "BIO321", "BIO266"] },
          { nombre: "Microbiolog√≠a", codigo: "BIO250", requisitos: ["BIO148"] },
          { nombre: "Laboratorio de Microbiolog√≠a", codigo: "BIO251", requisitos: ["BIO242"] },
          { nombre: "√âtica M√©dica I", codigo: "MED258", requisitos: ["MED122"] },
          { nombre: "T√≥picos de Investigaci√≥n en Salud I", codigo: "MED278", requisitos: ["FMM007", "FMF019"] }
        ]
      },
      {
        periodo: "Semestre 6",
        ramos: [
          { nombre: "Medicina Orientada al Problema", codigo: "MED249", requisitos: ["MED250"] },
          { nombre: "Fisiopatolog√≠a Humana", codigo: "MED260", requisitos: ["BIO377"] },
          { nombre: "Farmacolog√≠a", codigo: "BIO288", requisitos: ["BIO266", "BIO377"] },
          { nombre: "√âtica M√©dica II", codigo: "MED259", requisitos: ["MED258"] },
          { nombre: "T√≥picos de Investigaci√≥n en Salud II", codigo: "MED279", requisitos: ["MED278"] }
        ]
      },
      /* Semestres 7 y 8: OJO con anuales */
      {
        periodo: "Semestre 7",
        ramos: [
          { nombre: "Medicina Interna", codigo: "MED296", anual: true, requisitos: ["MED249", "MED260", "BIO288", "MED257"] },
          { nombre: "Cirug√≠a", codigo: "MED287", anual: true, requisitos: ["MED249", "MED260", "BIO288"] },
          { nombre: "Neurolog√≠a", codigo: "MED244", requisitos: ["MED249", "BIO288"] },
          { nombre: "Patolog√≠a I", codigo: "MED294", requisitos: ["BIO320","BIO321","BIO377"] },
          { nombre: "Salud P√∫blica I", codigo: "MED292", requisitos: ["MED279"] }
        ]
      },
      {
        periodo: "Semestre 8",
        ramos: [
          { nombre: "Patolog√≠a II", codigo: "MED295", requisitos: ["MED294"] },
          { nombre: "Salud P√∫blica II", codigo: "MED293", requisitos: ["MED292"] },
          { nombre: "Psiquiatr√≠a", codigo: "MED245", requisitos: ["MED131"] }
        ]
      },
      /* A√±os 5-7 con MALLA_COMPLETA escalonada */
      {
        periodo: "A√±o 5",
        ramos: [
          { nombre: "Otorrinolaringolog√≠a", codigo: "MED281", requisitos: ["MALLA_COMPLETA"] },
          { nombre: "Dermatolog√≠a", codigo: "MED282", requisitos: ["MALLA_COMPLETA"] },
          { nombre: "Urolog√≠a", codigo: "MED283", requisitos: ["MALLA_COMPLETA"] },
          { nombre: "Oftalmolog√≠a", codigo: "MED284", requisitos: ["MALLA_COMPLETA"] },
          { nombre: "Medicina Legal", codigo: "MED285", requisitos: ["MALLA_COMPLETA"] },
          { nombre: "Pediatr√≠a", codigo: "MED297", requisitos: ["MALLA_COMPLETA"] },
          { nombre: "Obstetricia y Ginecolog√≠a", codigo: "MED298", requisitos: ["MALLA_COMPLETA"] }
        ]
      },
      {
        periodo: "A√±o 6",
        ramos: [
          { nombre: "Internado de Pediatr√≠a", codigo: "MED374", requisitos: ["MALLA_COMPLETA"] },
          { nombre: "Internado de Cirug√≠a", codigo: "MED375", requisitos: ["MALLA_COMPLETA"] },
          { nombre: "Internado de Obstetricia y Ginecolog√≠a", codigo: "MED376", requisitos: ["MALLA_COMPLETA"] }
        ]
      },
      {
        periodo: "A√±o 7",
        ramos: [
          { nombre: "Internado Electivo", codigo: "MED300", requisitos: ["MALLA_COMPLETA"] },
          { nombre: "Internado de Medicina Interna", codigo: "MED377", requisitos: ["MALLA_COMPLETA"] },
          { nombre: "Internado de Medicina Comunitaria", codigo: "MED378", requisitos: ["MALLA_COMPLETA"] },
          { nombre: "Internado Integrado", codigo: "MED380", requisitos: ["MALLA_COMPLETA"] }
        ]
      }
    ];

    /* =========================
       ESTADO + UTILIDADES
       ========================= */
    let aprobados = JSON.parse(localStorage.getItem("aprobadosMedicina")) || [];

    function estaAprobado(codigo) {
      return aprobados.includes(codigo);
    }

    // Requisitos: incluye regla MALLA_COMPLETA escalonada por a√±o
    function cumpleRequisitos(ramo, periodoActual) {
      if (!ramo.requisitos) return true;

      if (ramo.requisitos.includes("MALLA_COMPLETA")) {
        let periodosPrevios = [];
        if (periodoActual.startsWith("A√±o 5")) {
          periodosPrevios = ["Semestre 1","Semestre 2","Semestre 3","Semestre 4","Semestre 5","Semestre 6","Semestre 7","Semestre 8"];
        } else if (periodoActual.startsWith("A√±o 6")) {
          periodosPrevios = ["Semestre 1","Semestre 2","Semestre 3","Semestre 4","Semestre 5","Semestre 6","Semestre 7","Semestre 8","A√±o 5"];
        } else if (periodoActual.startsWith("A√±o 7")) {
          periodosPrevios = ["Semestre 1","Semestre 2","Semestre 3","Semestre 4","Semestre 5","Semestre 6","Semestre 7","Semestre 8","A√±o 5","A√±o 6"];
        } else {
          periodosPrevios = ["Semestre 1","Semestre 2","Semestre 3","Semestre 4","Semestre 5","Semestre 6","Semestre 7","Semestre 8"];
        }

        return malla
          .filter(p => periodosPrevios.includes(p.periodo))
          .flatMap(p => p.ramos)
          .every(r => estaAprobado(r.codigo));
      }

      return ramo.requisitos.every(req => estaAprobado(req));
    }

    function guardarEstado() {
      localStorage.setItem("aprobadosMedicina", JSON.stringify(aprobados));
    }

    /* =========================
       RENDER
       ========================= */
    function crearTarjetaRamo(ramo, periodoEtiqueta) {
      const div = document.createElement("div");
      div.className = "ramo";

      // Estado inicial (aprobado/bloqueado)
      const puede = cumpleRequisitos(ramo, periodoEtiqueta);
      if (estaAprobado(ramo.codigo)) div.classList.add("aprobado");
      else if (!puede) div.classList.add("bloqueado");

      // Contenido
      div.innerHTML = `${ramo.nombre} <span class="codigo">(${ramo.codigo})</span>`;
      if (ramo.anual) {
        const tag = document.createElement("span");
        tag.className = "anual-tag";
        tag.textContent = "Anual 7‚Äì8";
        div.appendChild(tag);
      }

      // Interacci√≥n
      if (puede || estaAprobado(ramo.codigo)) {
        div.addEventListener("click", () => {
          if (estaAprobado(ramo.codigo)) {
            aprobados = aprobados.filter(c => c !== ramo.codigo);
          } else {
            aprobados.push(ramo.codigo);
          }
          guardarEstado();
          renderizarMalla();
        });
      }

      return div;
    }

    function renderizarMalla() {
      const contenedor = document.getElementById("contenedor");
      contenedor.innerHTML = "";

      // Buscamos objetos de 7 y 8 para el bloque especial
      const sem7 = malla.find(p => p.periodo === "Semestre 7");
      const sem8 = malla.find(p => p.periodo === "Semestre 8");

      malla.forEach(periodo => {
        // Salta 7 y 8 aqu√≠; los renderizamos juntos m√°s abajo
        if (periodo.periodo === "Semestre 7" || periodo.periodo === "Semestre 8") return;

        const col = document.createElement("div");
        col.className = "columna";
        const h2 = document.createElement("h2");
        h2.textContent = periodo.periodo;
        col.appendChild(h2);

        periodo.ramos.forEach(ramo => {
          const card = crearTarjetaRamo(ramo, periodo.periodo);
          col.appendChild(card);
        });

        contenedor.appendChild(col);
      });

      // ===== Bloque especial: Semestre 7 + Semestre 8 + barra anual que los cruza =====
      if (sem7 && sem8) {
        const wrap = document.createElement("div");
        wrap.className = "wrapper-7-8";

        // Barra anual que ocupa ambas columnas
        const barraAnual = document.createElement("div");
        barraAnual.className = "barra-anual";

        // Anuales del Semestre 7
        const anuales = sem7.ramos.filter(r => r.anual);
        anuales.forEach(ramoAnual => {
          const card = crearTarjetaRamo(ramoAnual, "Semestre 7");
          card.classList.add("anual"); // estilo barra larga
          barraAnual.appendChild(card);
        });

        // Columna Semestre 7 (sin los anuales)
        const col7 = document.createElement("div");
        col7.className = "columna";
        const h7 = document.createElement("h2");
        h7.textContent = "Semestre 7";
        col7.appendChild(h7);
        sem7.ramos.filter(r => !r.anual).forEach(ramo => {
          const card = crearTarjetaRamo(ramo, "Semestre 7");
          col7.appendChild(card);
        });

        // Columna Semestre 8 (normal)
        const col8 = document.createElement("div");
        col8.className = "columna";
        const h8 = document.createElement("h2");
        h8.textContent = "Semestre 8";
        col8.appendChild(h8);
        sem8.ramos.forEach(ramo => {
          const card = crearTarjetaRamo(ramo, "Semestre 8");
          col8.appendChild(card);
        });

        // Orden: barra anual arriba, luego columnas 7 y 8
        wrap.appendChild(barraAnual);
        wrap.appendChild(col7);
        wrap.appendChild(col8);

        contenedor.appendChild(wrap);
      }
    }

    // Primer render
    renderizarMalla();
  </script>
</body>
</html>
